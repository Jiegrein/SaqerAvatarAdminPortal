@page
@model ChatsHistoryModel
@{
    ViewData["Title"] = "Chats History";
}

<!-- Page Header -->
<section class="page-header">
    <div class="page-title">
        <h2><i class="fas fa-history"></i> Chats History</h2>
        <p>View and manage all chat conversations</p>
    </div>
</section>

<!-- Date Filter Section -->
<section class="filter-section">
    <div class="filter-card">
        <h3><i class="fas fa-filter"></i> Filter by Date</h3>
        <form method="get" class="filter-form">
            <div class="filter-controls">
                <div class="date-group">
                    <label asp-for="SelectedDate">Select Date:</label>
                    <input asp-for="SelectedDate" class="date-input" />
                    <span asp-validation-for="SelectedDate" class="text-danger"></span>
                </div>
                <div class="filter-buttons">
                    <button type="submit" class="filter-btn">
                        <i class="fas fa-search"></i> Apply Filter
                    </button>
                </div>
            </div>
        </form>
        
        <!-- Quick date buttons -->
        <div class="quick-date-buttons">
            <form method="post" asp-page-handler="SetDate" style="display: inline;">
                <input type="hidden" name="dateType" value="today" />
                <button type="submit" class="secondary-btn">
                    <i class="fas fa-calendar-day"></i> Today
                </button>
            </form>
            <form method="post" asp-page-handler="SetDate" style="display: inline;">
                <input type="hidden" name="dateType" value="yesterday" />
                <button type="submit" class="secondary-btn">
                    <i class="fas fa-calendar-minus"></i> Yesterday
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Stats Summary -->
<section class="stats-section">
    <div class="stats-grid history-stats">
        <div class="stat-card total-chats">
            <div class="stat-icon">
                <i class="fas fa-comments"></i>
            </div>
            <div class="stat-content">
                <h3>Total Chats Today</h3>
                <div class="stat-number">@Model.Stats.TotalChats</div>
            </div>
        </div>
        
        <div class="stat-card success-chats">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <h3>Successful Chats</h3>
                <div class="stat-number">@Model.Stats.SuccessChats</div>
            </div>
        </div>
        
        <div class="stat-card failed-chats">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>Failed Chats</h3>
                <div class="stat-number">@Model.Stats.FailedChats</div>
            </div>
        </div>
        
        <div class="stat-card rating-average">
            <div class="stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>Average Rating</h3>
                <div class="stat-number">@Model.Stats.AverageRating</div>
            </div>
        </div>
    </div>
</section>

<!-- Chats History Table -->
<section class="table-section">
    <div class="table-card">
        <div class="table-header">
            <h3><i class="fas fa-list"></i> Chat Conversations</h3>
            <div class="table-actions">
                <form method="get" class="search-form">
                    <input type="hidden" asp-for="SelectedDate" />
                    <input type="hidden" asp-for="PageNumber" value="1" />
                    
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input asp-for="SearchQuery" placeholder="Search chats..." />
                        <span asp-validation-for="SearchQuery" class="text-danger"></span>
                    </div>
                    
                    <select asp-for="SelectedCategory" class="category-select">
                        <option value="">All Categories</option>
                        @foreach (var category in Model.Categories)
                        {
                            <option value="@category">@category</option>
                        }
                    </select>
                    
                    <button type="submit" class="search-btn">Filter</button>
                </form>
            </div>
        </div>
        
        <div class="table-container">
            @{
                ViewData["ShowPagination"] = "true";
                ViewData["TableId"] = "chatsHistoryTable";
                ViewData["TableTitle"] = "Chat Conversations";
            }
            
            <partial name="_ChatsTablePartial" model="Model.Chats" />
        </div>
        
        <!-- Pagination -->
        @if (Model.Chats.TotalPages > 1)
        {
            <nav class="pagination">
                <a asp-page="./ChatsHistory" 
                   asp-route-SelectedDate="@Model.SelectedDate.ToString("yyyy-MM-dd")"
                   asp-route-SearchQuery="@Model.SearchQuery"
                   asp-route-SelectedCategory="@Model.SelectedCategory"
                   asp-route-PageNumber="@(Model.Chats.HasPreviousPage ? Model.Chats.PageIndex - 1 : 1)"
                   class="pagination-btn @(!Model.Chats.HasPreviousPage ? "disabled" : "")">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
                
                <div class="pagination-info">
                    <span>Page @Model.Chats.PageIndex of @Model.Chats.TotalPages</span>
                </div>
                
                <a asp-page="./ChatsHistory" 
                   asp-route-SelectedDate="@Model.SelectedDate.ToString("yyyy-MM-dd")"
                   asp-route-SearchQuery="@Model.SearchQuery"
                   asp-route-SelectedCategory="@Model.SelectedCategory"
                   asp-route-PageNumber="@(Model.Chats.HasNextPage ? Model.Chats.PageIndex + 1 : Model.Chats.TotalPages)"
                   class="pagination-btn @(!Model.Chats.HasNextPage ? "disabled" : "")">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
            </nav>
        }
    </div>
</section>

<!-- Chat History Modal -->
<partial name="_ChatModal" />

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/chat-modal.js" asp-append-version="true"></script>
}